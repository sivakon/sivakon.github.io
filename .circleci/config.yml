version: 2

jobs:
  build:
    docker:
      - image: cibuilds/hugo:0.60
    environment:
      - working_directory: /home/circleci/repo
    steps:

      # checkout the repository
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "44:3b:1c:05:3c:e1:9d:5f:55:ed:69:18:33:aa:28:0f"
      # build with Hugo
      - run: HUGO_ENV=production hugo -v

      - run:
          name: push everything
          command: |
            git config user.email "sivaram.konanki@rakuten.com"
            git config user.name "Sivaram Konanki"
            git status
            git add -A
            git commit -m "[skip ci] built from circleci and pushed"
            git push -u origin master
